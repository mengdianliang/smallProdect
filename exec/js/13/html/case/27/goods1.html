<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>商品下架</title>
    <style>
        body{
            margin: 0;
            font-family: 'MICROSOFT YAHEI';
            font-size: 12px;
            color: #ffffff;
            background-color: #ff8080;
        }
        h3{
            margin: 0;
        }
        ul{
            list-style: none;
            margin: 0;
            padding: 0;
        }
        a{
            text-decoration: none;
            color: #ffffff;
        }
        img{
            vertical-align: top;
            border: none;
        }
        input{
            padding: 0;
            border: none;
            outline: none;
        }
        .fl{
            float: left;
        }
        .fr{
            float: right;
        }
        .clearfix{
            *zoom: 1;
        }
        .clearfix:after{
            content: '';
            display: block;
            clear: both;
        }
        .wrapper{
            width: 1040px;
            height: 500px;
            margin: 50px auto 0;
        }
        .tit{
            font-size: 26px;
            font-weight: normal;
            line-height: 60px;
            text-align: center;
        }
        .list li{
            width: 240px;
            height: 280px;
            margin: 0 10px;
            position: relative;
            border-radius: 3px;
            overflow: hidden;
        }
        .edit{
            width: 100%;
            height: 40px;
            font-size: 14px;
            background-color: #000000;
        }
        .newTime{
            margin: 8px 10px;
            text-indent:5px;
            width: 160px;
            height: 22px;
            background-color: #000000;
            color: #ff8080;
            border-bottom: 1px solid #ff8080;
        }
        .confirm{
            width:60px;
            text-align: center;
            line-height: 40px;
            color: #ff8080;
        }
        .con{
            position: absolute;
            top: 40px;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .list li img{
            width: 240px;
        }
        .leave_time{
            position: absolute;
            width: 100%;
            top: 20px;
            text-align: center;
            color: #ffffff;
            padding: 0 10px;
            font-size: 14px;
        }
        .leaver{
            display: inline-block;
            line-height: 30px;
        }
        .time_interval{
            position: absolute;
            width: 100%;
            top: 50px;
            text-align: center;
        }
        .time_interval .count{
            width: 16px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            background-color: #ff8080;
            display: inline-block;
            margin-left: 4px;
        }
        .dcount_wrapper{
            display: inline-block;
        }
        .dcount{
            font-size: 24px;
            line-height: 30px;
        }
        .point{
            width: 10px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            color: #ff8080;
        }
        .con_tit{
            position: absolute;
            width: 100%;
            top: 120px;
            left: 0;
            font-size: 20px;
            text-align: center;
        }
        .con_pri{
            position: absolute;
            width: 100%;
            top: 150px;
            left: 0;
            font-size: 16px;
            text-align: center;
        }
        .red{
            color: #ff0000;
        }
        .modal{
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height:100%;
            display: none;
            background-color: #000000;
            opacity: 0;
        }
        .logo{
            position: absolute;
            top: 115px;
            left: 85px;
            border-radius: 60px;
            width: 70px;
            height: 70px;
            border: 1px solid #ff8080;
            color: #ff8080;
            text-align: center;
            line-height: 70px;
            opacity: 0.6;
            transform: scale(3) rotate(-30deg);
            display: none;
        }
        .calculate{
            padding-top: 20px;
            width: 1020px;
            margin: 0 auto;
            opacity:0;
        }
        .cal_header{
            padding: 0 20px;
            background-color: #000000;
            height: 40px;
            line-height: 40px;

         }
        .cal_header li{
            width: 33%;
            font-size: 16px;
        }
        .ig_pic{
            text-align: right;
        }
        .cal_info{
            background-color: #ffffff;
        }
        .cal_info li{
            padding: 0 20px;
            height: 50px;
            line-height: 50px;
            font-size: 14px;
            opacity: 0;
        }
        .gray{
            background-color: #eeeeee;
        }
        .cal_info li span{
            width: 33%;
        }
        .goods_name{
            color: #000000;
        }
        .goods_pic{
            width: 40px;
            margin-top: 5px;
        }

    </style>
</head>
<body>
    <section class="wrapper">
        <h3 class="tit">商品下架</h3>
        <ul class="list clearfix">
            <li class="fl">
                <div class="edit">
                    <input type="text" class="newTime fl"/>
                    <a href="javascript:void(0);" class="confirm fl">确定</a>
                </div>

                <div class="con">
                    <div class="leave_time">
                        <span class="leaver">剩余：</span>
                        <span class="dcount_wrapper">
                            <span class="dcount">0</span>
                            <span class="point">天</span>
                        </span>
                    </div>
                    <div class="time_interval">
                        <span class="count">0</span>
                        <span class="count">0</span>
                        <span class="point">:</span>
                        <span class="count">0</span>
                        <span class="count">0</span>
                        <span class="point">:</span>
                        <span class="count">0</span>
                        <span class="count">0</span>
                    </div>
                    <img src="img/1.jpg" class="con_pic"/>
                    <div class="con_tit">外套1 7折起</div>
                    <div class="con_pri">抢购价：<span class="red">￥</span><span class="red price">800</span></div>
                </div>
                <div class="modal"></div>
                <div class="logo">商品已下架</div>
            </li>
            <li class="fl">
                <div class="edit">
                    <input type="text" class="newTime fl"/>
                    <a href="javascript:void(0);" class="confirm fl">确定</a>
                </div>

                <div class="con">
                    <div class="leave_time">
                        <span class="leaver">剩余：</span>
                        <span class="dcount_wrapper">
                            <span class="dcount">0</span>
                            <span class="point">天</span>
                        </span>
                    </div>
                    <div class="time_interval">
                        <span class="count">0</span>
                        <span class="count">0</span>
                        <span class="point">:</span>
                        <span class="count">0</span>
                        <span class="count">0</span>
                        <span class="point">:</span>
                        <span class="count">0</span>
                        <span class="count">0</span>
                    </div>
                    <img src="img/2.jpg" class="con_pic"/>
                    <div class="con_tit">外套2 7折起</div>
                    <div class="con_pri">抢购价：<span class="red">￥</span><span class="red price">600</span></div>
                </div>
                <div class="modal"></div>
                <div class="logo">商品已下架</div>
            </li>
            <li class="fl">
                <div class="edit">
                    <input type="text" class="newTime fl"/>
                    <a href="javascript:void(0);" class="confirm fl">确定</a>
                </div>

                <div class="con">
                    <div class="leave_time">
                        <span class="leaver">剩余：</span>
                        <span class="dcount_wrapper">
                            <span class="dcount">0</span>
                            <span class="point">天</span>
                        </span>
                    </div>
                    <div class="time_interval">
                        <span class="count">0</span>
                        <span class="count">0</span>
                        <span class="point">:</span>
                        <span class="count">0</span>
                        <span class="count">0</span>
                        <span class="point">:</span>
                        <span class="count">0</span>
                        <span class="count">0</span>
                    </div>
                    <img src="img/3.jpg" class="con_pic"/>
                    <div class="con_tit">外套2 7折起</div>
                    <div class="con_pri">抢购价：<span class="red">￥</span><span class="red price">600</span></div>
                </div>
                <div class="modal"></div>
                <div class="logo">商品已下架</div>
            </li>
            <li class="fl">
                <div class="edit">
                    <input type="text" class="newTime fl"/>
                    <a href="javascript:void(0);" class="confirm fl">确定</a>
                </div>

                <div class="con">
                    <div class="leave_time">
                        <span class="leaver">剩余：</span>
                        <span class="dcount_wrapper">
                            <span class="dcount">0</span>
                            <span class="point">天</span>
                        </span>
                    </div>
                    <div class="time_interval">
                        <span class="count">0</span>
                        <span class="count">0</span>
                        <span class="point">:</span>
                        <span class="count">0</span>
                        <span class="count">0</span>
                        <span class="point">:</span>
                        <span class="count">0</span>
                        <span class="count">0</span>
                    </div>
                    <img src="img/4.jpg" class="con_pic"/>
                    <div class="con_tit">外套2 7折起</div>
                    <div class="con_pri">抢购价：<span class="red">￥</span><span class="red price">600</span></div>
                </div>
                <div class="modal"></div>
                <div class="logo">商品已下架</div>
            </li>
        </ul>
        <div class="calculate">
            <ul class="cal_header clearfix">
                <li class="fl">商品</li>
                <li class="fl">价格</li>
                <li class="fl ig_pic">简图</li>
            </ul>
            <ul class="cal_info">
            </ul>
        </div>
    </section>
</body>
<script src="js/MTween.js"></script>
<script src="js/shakeMove.js"></script>
<script>
    window.onload = function(){
        var lists = $('.list li'); //获取商品集合
        var newTime = $('.newTime');  //时间输入框
        var confirm = $('.confirm');  //确定按钮
        var pics = $('.con');  //获取商品图片
        var logos = $('.logo'); //获取logo
        var modals = $('.modal'); //获取遮罩层


        var imgs = ['./img/1.jpg','./img/2.jpg','./img/3.jpg','./img/4.jpg'];

        init();
        //代码初始化
        function init(){
            initVal();
            getObj();
        }
        //初始化值
        function initVal(){
            var cals = $('.cal_info li');
            for(var i = 0;i < cals.length;i++){
                if(i % 2 != 0){
                    cals[i].className = 'gray';
                }
            }
        }
        //代码去重
        function commons(){}

        //获取对象
        function getObj(){
            for(var i = 0;i < confirm.length;i++){
                confirm[i].index = i;
                confirm[i].onclick = function(){
                    getNewTime(this);
                };
            }
        }
        //时间执行
        function getNewTime(obj){
            var temp = (newTime[obj.index].value).trim();
            var temp1 = temp.split(' ').join(':').split(':');
            var newT = new Date(temp1[0],temp1[1] - 1,temp1[2],temp1[3],temp1[4],temp1[5]).getTime();
            timeCommon(obj,newT);
            timeInterval(obj,newT,function(){
                logoDown(logos[obj.index],function(){
                    shakeMove({obj:lists[obj.index],attr:'left',target:'10'});
                    opcyDown(modals[obj.index],40,function(){
                        $('.calculate')[0].style.opacity = 1;
                        addGoods(obj);
                    });
                });
            });
        }
        //倒计时定时器
        function timeInterval(obj,newT,fn){
            clearInterval(obj.timer);
            obj.dTime = setInterval(function(){
                timeCommon(obj,newT,fn);

                //2017 7 25 16:45:00
            },1000);
        }
        //倒计时时间戳
        function timeCommon(obj,newT,fn){
            var dt = new Date().getTime();
            var lea = newT - dt;
            var d = parseInt(lea/86400000);
            var h = preZero(parseInt(lea%86400000/3600000),2); //这里有问题
            var m = preZero(parseInt(lea%3600000/60000),2);
            var s = preZero(parseInt(lea%60000/1000),2);
            $('.dcount')[obj.index].innerHTML = d;
            var str = h + m + s;
            for(var j = 0;j < $('.count',pics[obj.index]).length;j++){
                $('.count',pics[obj.index])[j].innerHTML = str.charAt(j);
            }
            if(lea <=0){
                clearInterval(obj.dTime);
                fn && fn();
            }
        }
        //前边补0
        function preZero(num,len){
            var str = "" + num;
            while(len - str.length){
                str = 0 + str;
            }
            return str;
        }

        //商品下架戳动画
        function logoDown(oper,fn){
            oper.style.display = 'block';
            oper.scal = 300;
            clearInterval(oper.timer);
            oper.timer = setInterval(function(){
                oper.scal -= 50;
                oper.style.transform = 'scale(' + oper.scal/100 + ') rotate(-30deg)';
                if(oper.scal <= 200){
                    clearInterval(oper.timer);
                    oper.scal = 200;
                    fn && fn();
                }
            },50);
        }
        //透明度动画
        function opcyDown(oper,alter,fn) {
            oper.style.display = 'block';
            oper.opcy = 0;
            clearInterval(oper.timer);
            oper.timer = setInterval(function () {
                oper.opcy += 10;
                oper.style.opacity = oper.opcy / 100;
                if (oper.opcy >= alter) {
                    clearInterval(oper.timer);
                    oper.opcy = alter;
                    fn && fn();
                }
            }, 50);
        }

            //统计下架商品
        function addGoods(obj){
            var calInfo = $('.cal_info')[0];
            var tit = $('.con_tit',lists[obj.index])[0].innerHTML;
            var price = $('.price',lists[obj.index])[0].innerHTML;
            var pic = imgs[obj.index];
            calInfo.innerHTML += '<li><span class="goods_name fl">' + tit + '</span><span class="goods_price red fl">￥' + price + '</span><img class="goods_pic fr" src="' + pic + '"/></li>';
            var calInfos = $('.cal_info li');
            opcyDown(calInfos[calInfos.length - 1],100);
        }

        //元素获取方法的重写
        /*
         * element是obj下的子元素
         * */
        function $(element,obj){
            if(obj == null){
                return document.querySelectorAll(element);
            }else{
                return obj.querySelectorAll(element);
            }
        }
    };
</script>
</html>